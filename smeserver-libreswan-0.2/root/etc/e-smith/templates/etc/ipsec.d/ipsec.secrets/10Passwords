{
    use strict;
    use warnings;
    use esmith::ConfigDB;
 
    my $configDB = esmith::ConfigDB->open_ro or die ("can't open Config DB");

    my $ipsecDB = esmith::ConfigDB->open_ro('ipsec_connections') or die ("cant connect to ipsec database");

    my $dbKey = 'ipsec';
    
    # This should get all the connections in an array

    my @connections = $ipsecDB->keys;
    
    print "17 @connections\n";
    
    $OUT .= "# ipsec.secrets\n";

    foreach my $ipsecprop (@connections)
    {
    
    print "25 Props $ipsecprop\n";
    
       # first we verify if IPSec is enabled for the connection
     
       my $ipsecstatus = $ipsecDB->get_prop("$ipsecprop",'status') || "disabled";
    
       print "27 Ipsec Status $ipsecstatus\n";
    
       print "29 Props $ipsecprop\n";
    
       print "31 $ipsecprop : $ipsecstatus\n";
    
       return "# $ipsecprop is disabled\n" unless $ipsecstatus eq "enabled";
    
       print "42 We did not return\n";
       my $right = $ipsecDB->get_prop("$ipsecprop",'right')||'';
       my $passwd = $ipsecDB->get_prop("$ipsecprop",'passwd')||'';
       $OUT .= "$right \%any \: PSK \"$passwd\"";
       $OUT .= "\n";
     
    }
}